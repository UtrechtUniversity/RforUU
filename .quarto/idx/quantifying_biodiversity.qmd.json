{"title":"Tutorial 3: Quantifying taxonomic diversity","markdown":{"yaml":{"title":"Tutorial 3: Quantifying taxonomic diversity","author":[{"name":"Benjamin Delory","orcid":"0000-0002-1190-8060","email":"b.m.m.delory@uu.nl","affiliations":[{"name":"Environmental sciences group, Copernicus institute of sustainable development, Utrecht University"}]}]},"headingText":"About this tutorial","containsRefs":false,"markdown":"\n\n\nWelcome to this tutorial on quantifying taxonomic diversity in R!\n\nThroughout this tutorial, you will **learn different ways to quantify species diversity in an ecosystem and become aware of some of the challenges associated with quantifying biodiversity**. This tutorial focuses on quantifying taxonomic diversity across scales (alpha, beta, and gamma diversity sensu [Whittaker 1960](https://esajournals.onlinelibrary.wiley.com/doi/abs/10.2307/1943563)). In addition, you will use the knowledge gained in tutorials 1 and 2 to calculate [Hill numbers](https://www.jstor.org/stable/1934352?seq=1) of order *q* (i.e. the effective number of species for a given diversity order *q* ) and plot diversity profiles to analyse and compare biodiversity between different sites in a hypothetical metacommunity. Particular attention will be paid to the importance of sampling effort when comparing biodiversity estimates between sites with different levels of biodiversity.\n\nThere are R packages that allow you to calculate all the diversity measures listed above, but we will not be using them in this tutorial. We would like you to write your own R code to calculate them. Once again, it's all about learning by doing.\n\nLet's get started!\n\n## A hypothetical metacommunity\n\nThe first step is to create some data to work with. You will do this by sampling wooden meeples (which are small board game pieces) to generate a site by species abundance matrix. Our hypothetical metacommunity consists of six paper bags (which represent different sampling sites), each containing 30 meeples (which represent different individuals living at a site). Meeples of the same colour belong to the same species. We will not give you any information about species diversity and composition at each site. You will have to obtain this information yourself, by repeatedly sampling each site without looking inside the bags.\n\nOur species pool consists of 10 different species, each represented by a different colour. This is a small species pool, but it is enough to meet the objectives of this tutorial.\n\n## Sampling procedure\n\nThe aim of this exercise is to simulate a survey carried out to characterise the taxonomic diversity of six sites making up our metacommunity. Each site will be sampled multiple times to simulate surveys in a number of quadrats/locations at each site.\n\nYou can start generating biodiversity data using the following procedure:\n\n1.  Divide into 6 sub-groups. Each sub-group should consist of 4 to 5 students.\n\n2.  Each sub-group takes one bag (each bag is labelled with a number from 1 to 6). The bags have a different composition and contain a different number of species.\n\n3.  One member of each a sub-group carefully mixes the content of the bag and randomly samples 6 individuals from the bag (this represents 20% of the individuals in a bag). Try not to look inside the bag to avoid any sampling bias.\n\n4.  Write down your observations in an Excel sheet (site as rows, species as columns).\n\n5.  Once your observations have been recorded, put your sample back into the bag and give the bag to another person in your group. Then, repeat the previous steps until you have at least five replicates. In your data sheet, report your observations independently for each replicate (i.e., each row in your data is a replicate within a site).\n\n6.  Once you have all the replicates needed for your bag, switch bags with another group and repeat the previous steps. Do this until you have five replicates for each bag.\n\n7.  Make sure that your data are formatted properly.\n\n## Exercises\n\n### Load R packages\n\nLoad *tidyverse*, *knitr*, and *viridis*.\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(viridis)\n```\n\n### Exercise 1: Calculate alpha, beta and gamma diversity\n\n**Alpha diversity** (within-habitat diversity) is the average number of species across sites in our hypothetical metacommunity. **Gamma diversity** (regional diversity) is the total number of species present in our hypothetical metacommunity. **Beta diversity** (between-habitat diversity differentiation) is gamma diversity divided by alpha diversity.\n\nUsing the data collected earlier, calculate alpha, beta and gamma diversity in our hypothetical metacommunity using R. First, import your data into R. Then, use knowledge from tutorials 1 and 2 to write R code to calculate alpha, beta, and gamma diversity in our metacommunity.\n\n::: panel-tabset\n## Example dataset\n\n```{r}\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n\n#Simulate some data\nBag1 <- rep(3,10)\nBag2 <- c(0,0,0,15,0,15,0,0,0,0)\nBag3 <- c(2,5,1,4,4,3,0,6,2,3)\nBag4 <- c(0,7,0,0,11,0,0,5,0,7)\nBag5 <- c(2,1,18,1,2,1,0,2,2,1)\nBag6 <- c(6,0,0,0,0,0,17,0,5,2)\n\ndata <- data.frame(Bag = rep(1:6, each=5),\n                   Replicate = rep(1:5, 6),\n                   Red=rep(NA, 30),\n                   Orange=rep(NA, 30),\n                   Yellow=rep(NA, 30),\n                   Green=rep(NA, 30),\n                   Blue=rep(NA, 30),\n                   Purple=rep(NA, 30),\n                   Pink=rep(NA, 30),\n                   White=rep(NA, 30),\n                   Grey=rep(NA, 30),\n                   Black=rep(NA, 30))\n\nset.seed(123)\n\nfor (i in 1:nrow(data)){\n  \n  if (i <= 5){bag <- Bag1}\n  if (i > 5 & i<=10){bag <- Bag2}\n  if (i > 10 & i<=15){bag <- Bag3}\n  if (i > 15 & i<=20){bag <- Bag4}\n  if (i > 20 & i<=25){bag <- Bag5}\n  if (i > 25 & i<=30){bag <- Bag6}\n  \n  s <- sample(c(rep(\"red\", bag[1]),\n          rep(\"orange\", bag[2]),\n          rep(\"yellow\", bag[3]),\n          rep(\"green\", bag[4]),\n          rep(\"blue\", bag[5]),\n          rep(\"purple\", bag[6]),\n          rep(\"pink\", bag[7]),\n          rep(\"white\", bag[8]),\n          rep(\"grey\", bag[9]),\n          rep(\"black\", bag[10])), 6, replace=FALSE)\n  \n  data$Red[i] <- sum(s==\"red\")\n  data$Orange[i] <- sum(s==\"orange\")\n  data$Yellow[i] <- sum(s==\"yellow\")\n  data$Green[i] <- sum(s==\"green\")\n  data$Blue[i] <- sum(s==\"blue\")\n  data$Purple[i] <- sum(s==\"purple\")\n  data$Pink[i] <- sum(s==\"pink\")\n  data$White[i] <- sum(s==\"white\")\n  data$Grey[i] <- sum(s==\"grey\")\n  data$Black[i] <- sum(s==\"black\")}\n```\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nkable(head(data, n=10))\n```\n\n## Solution (gamma)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\ngamma <- as.numeric(data |> \n                      pivot_longer(Red:Black,\n                                   names_to = \"Species\",\n                                   values_to = \"Abundance\") |> \n                      group_by(Species) |> \n                      summarise(Abundance = sum(Abundance)) |> \n                      summarise(Gamma = sum(Abundance > 0)))\n```\n\nGamma diversity: `r gamma`\n\n## Solution (alpha)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nalpha <- round(as.numeric(data |> \n                            pivot_longer(Red:Black,\n                                         names_to = \"Species\",\n                                         values_to = \"Abundance\") |> \n                            group_by(Bag, Species) |> \n                            summarise(Abundance = sum(Abundance)) |> \n                            group_by(Bag) |>\n                            summarise(Alpha = sum(Abundance > 0)) |> \n                            summarise(Alpha = mean(Alpha))), 1)\n```\n\nAlpha diversity: `r alpha`\n\n## Solution (beta)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nbeta <- round(gamma/alpha, 1)\n```\n\nBeta diversity: `r beta`\n:::\n\n### Exercise 2: Calculate the average species richness at each site\n\nUse what you learned in previous tutorials to calculate the average number of species at each site.\n\n::: panel-tabset\n## Solution (code)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\ntable <- data |> \n          pivot_longer(Red:Black,\n                       names_to = \"Species\",\n                       values_to = \"Abundance\") |> \n          group_by(Bag, Replicate) |> \n          summarise(Richness = sum(Abundance>0)) |> \n          group_by(Bag) |> \n          summarise(Avg_richness = round(mean(Richness), 1))\n```\n\n## Solution (table)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nkable(table)\n```\n:::\n\n### Exercise 3: Calculate the effective number of species (Hill numbers)\n\nIn a community consisting of *n* species, the Hill number (or effective number of species) of order *q* can be calculated using @eq-hill-1 ($q \\geq 0$, $q\\neq1$) and @eq-hill-2 ($q=1$), where *p~i~* is the relative abundance of species *i* in the community ($p_i \\in [0,1]$).\n\n$$ ^qD = (\\sum_{i=1}^{n}p_i^q)^{\\frac{1}{1-q}}  $$ {#eq-hill-1}\n\n$$ ^1D=exp(-\\sum_{i=1}^{n}p_i\\log p_i) $$ {#eq-hill-2}\n\nUse @eq-hill-1 and @eq-hill-2 to calculate the effective number of species of order 0 (species richness), 1 (Hill-Shannon, the exponential of Shannon's entropy) and 2 (Hill-Simpson, the inverse of Simpson's concentration index) at each site of our hypothetical metacommunity. Plot your results in a figure with 6 panels (one panel for each site). For each site, plot the effective number of species as a function of *q* (this is called a diversity profile plot). Plot separate lines (using `geom_line()`) for each replicate (the `group` argument in `aes()` will be useful here).\n\nWhat do you observe? What can you conclude about the taxonomic diversity at each site?\n\n::: panel-tabset\n## Solution (code)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nplot <- data |> \n          mutate(Total = Red+Orange+Yellow+Green+Blue+Purple+Pink+White+Grey+Black) |> \n          mutate(Red=Red/Total,\n                 Orange=Orange/Total,\n                 Yellow=Yellow/Total,\n                 Green=Green/Total,\n                 Blue=Blue/Total,\n                 Purple=Purple/Total,\n                 Pink=Pink/Total,\n                 White=White/Total,\n                 Grey=Grey/Total,\n                 Black=Black/Total) |> \n          pivot_longer(Red:Black,\n                       names_to = \"Species\",\n                       values_to = \"Abundance\") |> \n          filter(Abundance!=0) |> \n          group_by(Bag, Replicate) |> \n          summarise(q0=sum(Abundance^0)^(1/(1-0)),\n                    q1=exp(-sum(Abundance*log(Abundance))),\n                    q2=sum(Abundance^2)^(1/(1-2))) |> \n          pivot_longer(q0:q2,\n                       names_to = \"q\",\n                       names_prefix = \"q\",\n                       names_transform = as.numeric,\n                       values_to = \"diversity\") |>\n          mutate(Bag=paste(\"Bag \", Bag, sep=\"\"),\n                 Replicate=as.factor(Replicate)) |> \n          ggplot(aes(x = q,\n                     y = diversity,\n                     group = Replicate,\n                     colour=Replicate))+\n            geom_line()+\n            geom_point(shape=16)+\n            facet_wrap(~Bag)+\n            theme_bw()+\n            xlab(\"Diversity order (q)\")+\n            ylab(\"Effective number of species (D)\")+\n            scale_colour_viridis(discrete=TRUE)+\n            theme(axis.title.x = element_text(margin = margin(t=10)),\n                  axis.title.y = element_text(margin = margin(r=10)),\n                  axis.text = element_text(colour=\"black\"),\n                  panel.grid.minor = element_blank())+\n            scale_x_continuous(breaks=c(0,1,2),\n                               limits = c(0,2))+\n            scale_y_continuous(breaks=seq(from = 0,\n                                          to = 10,\n                                          by = 2),\n                               limits=c(0,10))\n```\n\n## Solution (plot)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| fig-align: center\n\nplot\n```\n:::\n\n### Exercise 4: The importance of sampling effort for estimating taxonomic diversity\n\nIn the first part of this tutorial, we estimated taxonomic diversity by randomly sampling 20% of the individuals living at each site. But what would happen if we increased the sampling effort and sampled 50% of the individuals present at each site? Using the same sampling procedure as above, create a new data set by randomly selecting 15 individuals per site and make a new version of the figure you created for the third exercise.\n\nWhat do you notice? What can you conclude about the importance of sampling effort in accurately quantifying biodiversity? In what situations does increasing the sampling effort make it possible to obtain better biodiversity estimates?\n\n::: panel-tabset\n## Solution (code)\n\n```{r}\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n\n#Simulate some data\nBag1 <- rep(3,10)\nBag2 <- c(0,0,0,15,0,15,0,0,0,0)\nBag3 <- c(2,5,1,4,4,3,0,6,2,3)\nBag4 <- c(0,7,0,0,11,0,0,5,0,7)\nBag5 <- c(2,1,18,1,2,1,0,2,2,1)\nBag6 <- c(6,0,0,0,0,0,17,0,5,2)\n\ndata <- data.frame(Bag = rep(1:6, each=5),\n                   Replicate = rep(1:5, 6),\n                   Red=rep(NA, 30),\n                   Orange=rep(NA, 30),\n                   Yellow=rep(NA, 30),\n                   Green=rep(NA, 30),\n                   Blue=rep(NA, 30),\n                   Purple=rep(NA, 30),\n                   Pink=rep(NA, 30),\n                   White=rep(NA, 30),\n                   Grey=rep(NA, 30),\n                   Black=rep(NA, 30))\n\nset.seed(234)\n\nfor (i in 1:nrow(data)){\n  \n  if (i <= 5){bag <- Bag1}\n  if (i > 5 & i<=10){bag <- Bag2}\n  if (i > 10 & i<=15){bag <- Bag3}\n  if (i > 15 & i<=20){bag <- Bag4}\n  if (i > 20 & i<=25){bag <- Bag5}\n  if (i > 25 & i<=30){bag <- Bag6}\n  \n  s <- sample(c(rep(\"red\", bag[1]),\n          rep(\"orange\", bag[2]),\n          rep(\"yellow\", bag[3]),\n          rep(\"green\", bag[4]),\n          rep(\"blue\", bag[5]),\n          rep(\"purple\", bag[6]),\n          rep(\"pink\", bag[7]),\n          rep(\"white\", bag[8]),\n          rep(\"grey\", bag[9]),\n          rep(\"black\", bag[10])), 15, replace=FALSE)\n  \n  data$Red[i] <- sum(s==\"red\")\n  data$Orange[i] <- sum(s==\"orange\")\n  data$Yellow[i] <- sum(s==\"yellow\")\n  data$Green[i] <- sum(s==\"green\")\n  data$Blue[i] <- sum(s==\"blue\")\n  data$Purple[i] <- sum(s==\"purple\")\n  data$Pink[i] <- sum(s==\"pink\")\n  data$White[i] <- sum(s==\"white\")\n  data$Grey[i] <- sum(s==\"grey\")\n  data$Black[i] <- sum(s==\"black\")}\n```\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nplot <- data |> \n          mutate(Total = Red+Orange+Yellow+Green+Blue+Purple+Pink+White+Grey+Black) |> \n          mutate(Red=Red/Total,\n                 Orange=Orange/Total,\n                 Yellow=Yellow/Total,\n                 Green=Green/Total,\n                 Blue=Blue/Total,\n                 Purple=Purple/Total,\n                 Pink=Pink/Total,\n                 White=White/Total,\n                 Grey=Grey/Total,\n                 Black=Black/Total) |> \n          pivot_longer(Red:Black,\n                       names_to = \"Species\",\n                       values_to = \"Abundance\") |> \n          filter(Abundance!=0) |> \n          group_by(Bag, Replicate) |> \n          summarise(q0=sum(Abundance^0)^(1/(1-0)),\n                    q1=exp(-sum(Abundance*log(Abundance))),\n                    q2=sum(Abundance^2)^(1/(1-2))) |> \n          pivot_longer(q0:q2,\n                       names_to = \"q\",\n                       names_prefix = \"q\",\n                       names_transform = as.numeric,\n                       values_to = \"diversity\") |>\n          mutate(Bag=paste(\"Bag \", Bag, sep=\"\"),\n                 Replicate=as.factor(Replicate)) |> \n          ggplot(aes(x = q,\n                     y = diversity,\n                     group = Replicate,\n                     colour=Replicate))+\n            geom_line()+\n            geom_point(shape=16)+\n            facet_wrap(~Bag)+\n            theme_bw()+\n            xlab(\"Diversity order (q)\")+\n            ylab(\"Effective number of species (D)\")+\n            scale_colour_viridis(discrete=TRUE)+\n            theme(axis.title.x = element_text(margin = margin(t=10)),\n                  axis.title.y = element_text(margin = margin(r=10)),\n                  axis.text = element_text(colour=\"black\"),\n                  panel.grid.minor = element_blank())+\n            scale_x_continuous(breaks=c(0,1,2),\n                               limits = c(0,2))+\n            scale_y_continuous(breaks=seq(from = 0,\n                                          to = 10,\n                                          by = 2),\n                               limits=c(0,10))\n```\n\n## Solution (plot)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| fig-align: center\n\nplot\n```\n:::\n\n## Suggested further reading\n\nOur tutorial can't cover everything, and there's still a lot to learn about quantifying biodiversity! If you are interested, take a look at these excellent papers.\n\n**Chao A, Chiu C-H, Jost L**. **2014**. [Unifying Species Diversity, Phylogenetic Diversity, Functional Diversity, and Related Similarity and Differentiation Measures Through Hill Numbers.](https://www.annualreviews.org/content/journals/10.1146/annurev-ecolsys-120213-091540) *Annual review of ecology, evolution, and systematics* **45**: 297--324.\n\n**Hill MO**. **1973**. [Diversity and evenness: A unifying notation and its consequences](https://www.jstor.org/stable/1934352?seq=1). *Ecology* **54**: 427--432.\n\n**Roswell M, Dushoff J, Winfree R**. **2021**. [A conceptual guide to measuring species diversity](https://nsojournals.onlinelibrary.wiley.com/doi/full/10.1111/oik.07202). *Oikos* **130**: 321--338.\n\n**Whittaker RH**. **1960**. [Vegetation of the siskiyou mountains, Oregon and California](https://www.jstor.org/stable/1943563). *Ecological monographs* **30**: 279--338.\n","srcMarkdownNoYaml":"\n\n## About this tutorial\n\nWelcome to this tutorial on quantifying taxonomic diversity in R!\n\nThroughout this tutorial, you will **learn different ways to quantify species diversity in an ecosystem and become aware of some of the challenges associated with quantifying biodiversity**. This tutorial focuses on quantifying taxonomic diversity across scales (alpha, beta, and gamma diversity sensu [Whittaker 1960](https://esajournals.onlinelibrary.wiley.com/doi/abs/10.2307/1943563)). In addition, you will use the knowledge gained in tutorials 1 and 2 to calculate [Hill numbers](https://www.jstor.org/stable/1934352?seq=1) of order *q* (i.e. the effective number of species for a given diversity order *q* ) and plot diversity profiles to analyse and compare biodiversity between different sites in a hypothetical metacommunity. Particular attention will be paid to the importance of sampling effort when comparing biodiversity estimates between sites with different levels of biodiversity.\n\nThere are R packages that allow you to calculate all the diversity measures listed above, but we will not be using them in this tutorial. We would like you to write your own R code to calculate them. Once again, it's all about learning by doing.\n\nLet's get started!\n\n## A hypothetical metacommunity\n\nThe first step is to create some data to work with. You will do this by sampling wooden meeples (which are small board game pieces) to generate a site by species abundance matrix. Our hypothetical metacommunity consists of six paper bags (which represent different sampling sites), each containing 30 meeples (which represent different individuals living at a site). Meeples of the same colour belong to the same species. We will not give you any information about species diversity and composition at each site. You will have to obtain this information yourself, by repeatedly sampling each site without looking inside the bags.\n\nOur species pool consists of 10 different species, each represented by a different colour. This is a small species pool, but it is enough to meet the objectives of this tutorial.\n\n## Sampling procedure\n\nThe aim of this exercise is to simulate a survey carried out to characterise the taxonomic diversity of six sites making up our metacommunity. Each site will be sampled multiple times to simulate surveys in a number of quadrats/locations at each site.\n\nYou can start generating biodiversity data using the following procedure:\n\n1.  Divide into 6 sub-groups. Each sub-group should consist of 4 to 5 students.\n\n2.  Each sub-group takes one bag (each bag is labelled with a number from 1 to 6). The bags have a different composition and contain a different number of species.\n\n3.  One member of each a sub-group carefully mixes the content of the bag and randomly samples 6 individuals from the bag (this represents 20% of the individuals in a bag). Try not to look inside the bag to avoid any sampling bias.\n\n4.  Write down your observations in an Excel sheet (site as rows, species as columns).\n\n5.  Once your observations have been recorded, put your sample back into the bag and give the bag to another person in your group. Then, repeat the previous steps until you have at least five replicates. In your data sheet, report your observations independently for each replicate (i.e., each row in your data is a replicate within a site).\n\n6.  Once you have all the replicates needed for your bag, switch bags with another group and repeat the previous steps. Do this until you have five replicates for each bag.\n\n7.  Make sure that your data are formatted properly.\n\n## Exercises\n\n### Load R packages\n\nLoad *tidyverse*, *knitr*, and *viridis*.\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(viridis)\n```\n\n### Exercise 1: Calculate alpha, beta and gamma diversity\n\n**Alpha diversity** (within-habitat diversity) is the average number of species across sites in our hypothetical metacommunity. **Gamma diversity** (regional diversity) is the total number of species present in our hypothetical metacommunity. **Beta diversity** (between-habitat diversity differentiation) is gamma diversity divided by alpha diversity.\n\nUsing the data collected earlier, calculate alpha, beta and gamma diversity in our hypothetical metacommunity using R. First, import your data into R. Then, use knowledge from tutorials 1 and 2 to write R code to calculate alpha, beta, and gamma diversity in our metacommunity.\n\n::: panel-tabset\n## Example dataset\n\n```{r}\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n\n#Simulate some data\nBag1 <- rep(3,10)\nBag2 <- c(0,0,0,15,0,15,0,0,0,0)\nBag3 <- c(2,5,1,4,4,3,0,6,2,3)\nBag4 <- c(0,7,0,0,11,0,0,5,0,7)\nBag5 <- c(2,1,18,1,2,1,0,2,2,1)\nBag6 <- c(6,0,0,0,0,0,17,0,5,2)\n\ndata <- data.frame(Bag = rep(1:6, each=5),\n                   Replicate = rep(1:5, 6),\n                   Red=rep(NA, 30),\n                   Orange=rep(NA, 30),\n                   Yellow=rep(NA, 30),\n                   Green=rep(NA, 30),\n                   Blue=rep(NA, 30),\n                   Purple=rep(NA, 30),\n                   Pink=rep(NA, 30),\n                   White=rep(NA, 30),\n                   Grey=rep(NA, 30),\n                   Black=rep(NA, 30))\n\nset.seed(123)\n\nfor (i in 1:nrow(data)){\n  \n  if (i <= 5){bag <- Bag1}\n  if (i > 5 & i<=10){bag <- Bag2}\n  if (i > 10 & i<=15){bag <- Bag3}\n  if (i > 15 & i<=20){bag <- Bag4}\n  if (i > 20 & i<=25){bag <- Bag5}\n  if (i > 25 & i<=30){bag <- Bag6}\n  \n  s <- sample(c(rep(\"red\", bag[1]),\n          rep(\"orange\", bag[2]),\n          rep(\"yellow\", bag[3]),\n          rep(\"green\", bag[4]),\n          rep(\"blue\", bag[5]),\n          rep(\"purple\", bag[6]),\n          rep(\"pink\", bag[7]),\n          rep(\"white\", bag[8]),\n          rep(\"grey\", bag[9]),\n          rep(\"black\", bag[10])), 6, replace=FALSE)\n  \n  data$Red[i] <- sum(s==\"red\")\n  data$Orange[i] <- sum(s==\"orange\")\n  data$Yellow[i] <- sum(s==\"yellow\")\n  data$Green[i] <- sum(s==\"green\")\n  data$Blue[i] <- sum(s==\"blue\")\n  data$Purple[i] <- sum(s==\"purple\")\n  data$Pink[i] <- sum(s==\"pink\")\n  data$White[i] <- sum(s==\"white\")\n  data$Grey[i] <- sum(s==\"grey\")\n  data$Black[i] <- sum(s==\"black\")}\n```\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nkable(head(data, n=10))\n```\n\n## Solution (gamma)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\ngamma <- as.numeric(data |> \n                      pivot_longer(Red:Black,\n                                   names_to = \"Species\",\n                                   values_to = \"Abundance\") |> \n                      group_by(Species) |> \n                      summarise(Abundance = sum(Abundance)) |> \n                      summarise(Gamma = sum(Abundance > 0)))\n```\n\nGamma diversity: `r gamma`\n\n## Solution (alpha)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nalpha <- round(as.numeric(data |> \n                            pivot_longer(Red:Black,\n                                         names_to = \"Species\",\n                                         values_to = \"Abundance\") |> \n                            group_by(Bag, Species) |> \n                            summarise(Abundance = sum(Abundance)) |> \n                            group_by(Bag) |>\n                            summarise(Alpha = sum(Abundance > 0)) |> \n                            summarise(Alpha = mean(Alpha))), 1)\n```\n\nAlpha diversity: `r alpha`\n\n## Solution (beta)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nbeta <- round(gamma/alpha, 1)\n```\n\nBeta diversity: `r beta`\n:::\n\n### Exercise 2: Calculate the average species richness at each site\n\nUse what you learned in previous tutorials to calculate the average number of species at each site.\n\n::: panel-tabset\n## Solution (code)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\ntable <- data |> \n          pivot_longer(Red:Black,\n                       names_to = \"Species\",\n                       values_to = \"Abundance\") |> \n          group_by(Bag, Replicate) |> \n          summarise(Richness = sum(Abundance>0)) |> \n          group_by(Bag) |> \n          summarise(Avg_richness = round(mean(Richness), 1))\n```\n\n## Solution (table)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nkable(table)\n```\n:::\n\n### Exercise 3: Calculate the effective number of species (Hill numbers)\n\nIn a community consisting of *n* species, the Hill number (or effective number of species) of order *q* can be calculated using @eq-hill-1 ($q \\geq 0$, $q\\neq1$) and @eq-hill-2 ($q=1$), where *p~i~* is the relative abundance of species *i* in the community ($p_i \\in [0,1]$).\n\n$$ ^qD = (\\sum_{i=1}^{n}p_i^q)^{\\frac{1}{1-q}}  $$ {#eq-hill-1}\n\n$$ ^1D=exp(-\\sum_{i=1}^{n}p_i\\log p_i) $$ {#eq-hill-2}\n\nUse @eq-hill-1 and @eq-hill-2 to calculate the effective number of species of order 0 (species richness), 1 (Hill-Shannon, the exponential of Shannon's entropy) and 2 (Hill-Simpson, the inverse of Simpson's concentration index) at each site of our hypothetical metacommunity. Plot your results in a figure with 6 panels (one panel for each site). For each site, plot the effective number of species as a function of *q* (this is called a diversity profile plot). Plot separate lines (using `geom_line()`) for each replicate (the `group` argument in `aes()` will be useful here).\n\nWhat do you observe? What can you conclude about the taxonomic diversity at each site?\n\n::: panel-tabset\n## Solution (code)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nplot <- data |> \n          mutate(Total = Red+Orange+Yellow+Green+Blue+Purple+Pink+White+Grey+Black) |> \n          mutate(Red=Red/Total,\n                 Orange=Orange/Total,\n                 Yellow=Yellow/Total,\n                 Green=Green/Total,\n                 Blue=Blue/Total,\n                 Purple=Purple/Total,\n                 Pink=Pink/Total,\n                 White=White/Total,\n                 Grey=Grey/Total,\n                 Black=Black/Total) |> \n          pivot_longer(Red:Black,\n                       names_to = \"Species\",\n                       values_to = \"Abundance\") |> \n          filter(Abundance!=0) |> \n          group_by(Bag, Replicate) |> \n          summarise(q0=sum(Abundance^0)^(1/(1-0)),\n                    q1=exp(-sum(Abundance*log(Abundance))),\n                    q2=sum(Abundance^2)^(1/(1-2))) |> \n          pivot_longer(q0:q2,\n                       names_to = \"q\",\n                       names_prefix = \"q\",\n                       names_transform = as.numeric,\n                       values_to = \"diversity\") |>\n          mutate(Bag=paste(\"Bag \", Bag, sep=\"\"),\n                 Replicate=as.factor(Replicate)) |> \n          ggplot(aes(x = q,\n                     y = diversity,\n                     group = Replicate,\n                     colour=Replicate))+\n            geom_line()+\n            geom_point(shape=16)+\n            facet_wrap(~Bag)+\n            theme_bw()+\n            xlab(\"Diversity order (q)\")+\n            ylab(\"Effective number of species (D)\")+\n            scale_colour_viridis(discrete=TRUE)+\n            theme(axis.title.x = element_text(margin = margin(t=10)),\n                  axis.title.y = element_text(margin = margin(r=10)),\n                  axis.text = element_text(colour=\"black\"),\n                  panel.grid.minor = element_blank())+\n            scale_x_continuous(breaks=c(0,1,2),\n                               limits = c(0,2))+\n            scale_y_continuous(breaks=seq(from = 0,\n                                          to = 10,\n                                          by = 2),\n                               limits=c(0,10))\n```\n\n## Solution (plot)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| fig-align: center\n\nplot\n```\n:::\n\n### Exercise 4: The importance of sampling effort for estimating taxonomic diversity\n\nIn the first part of this tutorial, we estimated taxonomic diversity by randomly sampling 20% of the individuals living at each site. But what would happen if we increased the sampling effort and sampled 50% of the individuals present at each site? Using the same sampling procedure as above, create a new data set by randomly selecting 15 individuals per site and make a new version of the figure you created for the third exercise.\n\nWhat do you notice? What can you conclude about the importance of sampling effort in accurately quantifying biodiversity? In what situations does increasing the sampling effort make it possible to obtain better biodiversity estimates?\n\n::: panel-tabset\n## Solution (code)\n\n```{r}\n#| eval: true\n#| echo: false\n#| warning: false\n#| message: false\n\n#Simulate some data\nBag1 <- rep(3,10)\nBag2 <- c(0,0,0,15,0,15,0,0,0,0)\nBag3 <- c(2,5,1,4,4,3,0,6,2,3)\nBag4 <- c(0,7,0,0,11,0,0,5,0,7)\nBag5 <- c(2,1,18,1,2,1,0,2,2,1)\nBag6 <- c(6,0,0,0,0,0,17,0,5,2)\n\ndata <- data.frame(Bag = rep(1:6, each=5),\n                   Replicate = rep(1:5, 6),\n                   Red=rep(NA, 30),\n                   Orange=rep(NA, 30),\n                   Yellow=rep(NA, 30),\n                   Green=rep(NA, 30),\n                   Blue=rep(NA, 30),\n                   Purple=rep(NA, 30),\n                   Pink=rep(NA, 30),\n                   White=rep(NA, 30),\n                   Grey=rep(NA, 30),\n                   Black=rep(NA, 30))\n\nset.seed(234)\n\nfor (i in 1:nrow(data)){\n  \n  if (i <= 5){bag <- Bag1}\n  if (i > 5 & i<=10){bag <- Bag2}\n  if (i > 10 & i<=15){bag <- Bag3}\n  if (i > 15 & i<=20){bag <- Bag4}\n  if (i > 20 & i<=25){bag <- Bag5}\n  if (i > 25 & i<=30){bag <- Bag6}\n  \n  s <- sample(c(rep(\"red\", bag[1]),\n          rep(\"orange\", bag[2]),\n          rep(\"yellow\", bag[3]),\n          rep(\"green\", bag[4]),\n          rep(\"blue\", bag[5]),\n          rep(\"purple\", bag[6]),\n          rep(\"pink\", bag[7]),\n          rep(\"white\", bag[8]),\n          rep(\"grey\", bag[9]),\n          rep(\"black\", bag[10])), 15, replace=FALSE)\n  \n  data$Red[i] <- sum(s==\"red\")\n  data$Orange[i] <- sum(s==\"orange\")\n  data$Yellow[i] <- sum(s==\"yellow\")\n  data$Green[i] <- sum(s==\"green\")\n  data$Blue[i] <- sum(s==\"blue\")\n  data$Purple[i] <- sum(s==\"purple\")\n  data$Pink[i] <- sum(s==\"pink\")\n  data$White[i] <- sum(s==\"white\")\n  data$Grey[i] <- sum(s==\"grey\")\n  data$Black[i] <- sum(s==\"black\")}\n```\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n\nplot <- data |> \n          mutate(Total = Red+Orange+Yellow+Green+Blue+Purple+Pink+White+Grey+Black) |> \n          mutate(Red=Red/Total,\n                 Orange=Orange/Total,\n                 Yellow=Yellow/Total,\n                 Green=Green/Total,\n                 Blue=Blue/Total,\n                 Purple=Purple/Total,\n                 Pink=Pink/Total,\n                 White=White/Total,\n                 Grey=Grey/Total,\n                 Black=Black/Total) |> \n          pivot_longer(Red:Black,\n                       names_to = \"Species\",\n                       values_to = \"Abundance\") |> \n          filter(Abundance!=0) |> \n          group_by(Bag, Replicate) |> \n          summarise(q0=sum(Abundance^0)^(1/(1-0)),\n                    q1=exp(-sum(Abundance*log(Abundance))),\n                    q2=sum(Abundance^2)^(1/(1-2))) |> \n          pivot_longer(q0:q2,\n                       names_to = \"q\",\n                       names_prefix = \"q\",\n                       names_transform = as.numeric,\n                       values_to = \"diversity\") |>\n          mutate(Bag=paste(\"Bag \", Bag, sep=\"\"),\n                 Replicate=as.factor(Replicate)) |> \n          ggplot(aes(x = q,\n                     y = diversity,\n                     group = Replicate,\n                     colour=Replicate))+\n            geom_line()+\n            geom_point(shape=16)+\n            facet_wrap(~Bag)+\n            theme_bw()+\n            xlab(\"Diversity order (q)\")+\n            ylab(\"Effective number of species (D)\")+\n            scale_colour_viridis(discrete=TRUE)+\n            theme(axis.title.x = element_text(margin = margin(t=10)),\n                  axis.title.y = element_text(margin = margin(r=10)),\n                  axis.text = element_text(colour=\"black\"),\n                  panel.grid.minor = element_blank())+\n            scale_x_continuous(breaks=c(0,1,2),\n                               limits = c(0,2))+\n            scale_y_continuous(breaks=seq(from = 0,\n                                          to = 10,\n                                          by = 2),\n                               limits=c(0,10))\n```\n\n## Solution (plot)\n\n```{r}\n#| eval: true\n#| echo: true\n#| warning: false\n#| message: false\n#| fig-align: center\n\nplot\n```\n:::\n\n## Suggested further reading\n\nOur tutorial can't cover everything, and there's still a lot to learn about quantifying biodiversity! If you are interested, take a look at these excellent papers.\n\n**Chao A, Chiu C-H, Jost L**. **2014**. [Unifying Species Diversity, Phylogenetic Diversity, Functional Diversity, and Related Similarity and Differentiation Measures Through Hill Numbers.](https://www.annualreviews.org/content/journals/10.1146/annurev-ecolsys-120213-091540) *Annual review of ecology, evolution, and systematics* **45**: 297--324.\n\n**Hill MO**. **1973**. [Diversity and evenness: A unifying notation and its consequences](https://www.jstor.org/stable/1934352?seq=1). *Ecology* **54**: 427--432.\n\n**Roswell M, Dushoff J, Winfree R**. **2021**. [A conceptual guide to measuring species diversity](https://nsojournals.onlinelibrary.wiley.com/doi/full/10.1111/oik.07202). *Oikos* **130**: 321--338.\n\n**Whittaker RH**. **1960**. [Vegetation of the siskiyou mountains, Oregon and California](https://www.jstor.org/stable/1943563). *Ecological monographs* **30**: 279--338.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":600,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"toc-depth":5,"output-file":"quantifying_biodiversity.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.433","editor":"visual","editor_options":{"chunk_output_type":"console"},"theme":{"light":["cosmo","theme-light.scss"],"dark":["cosmo","theme-dark.scss"]},"code-copy":true,"code-summary":"Show me the R code","fig-cap-location":"bottom","title":"Tutorial 3: Quantifying taxonomic diversity","author":[{"name":"Benjamin Delory","orcid":"0000-0002-1190-8060","email":"b.m.m.delory@uu.nl","affiliations":[{"name":"Environmental sciences group, Copernicus institute of sustainable development, Utrecht University"}]}]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}