---
title: "Tutorial 2: Data visualisation in R"
author:
  - name: Benjamin Delory & Daniil Scheifes
    orcid: 0000-0002-1190-8060
    email: b.m.m.delory@uu.nl
    affiliations:
      - name: Environmental sciences group, Copernicus institute of sustainable development, Utrecht University
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

## About this tutorial

Welcome to this tutorial on data visualisation in R!

Throughout this tutorial, **our goal is to provide you with basic tools for visualizing your datasets in R.** After organizing some variables, computing new ones, and filtering data for statistical analyses we are now left with plotting and visualizing our data. This tutorial is all about mastering this fundamental skill!Today we will be working with two datasets on plant communities across Eurasia: Wassen et al (2021) and *Sheifes et al., (2024)*.

Lets start with the first! Wassen et al. (2021) showed in their publication that threatened species are most commonly found in soils with relatively low phosphorus (P) and phosphorus (P) to Nitrogen (N) content. In this study, they determined a N to P median niche value and compared species that were threatened to those that were not using two boxplots. Today we will recreate and improve this visualization.

For this, we must install the most used data visualization package in the R programming language: ggplot2. With ggplot2, we can generate a wide variety of plots, including scatter plots, bar plots, histograms, box plots, and more, while having control over aesthetics such as colors, shapes, and
labels by using a variety of functions.

So lets install and load ggplot2!

```{r}
# Install ggplot2 package
install.packages('ggplot2')

# Load the ggplot2 package 
library(ggplot2)
```

If you are stuck or want help, also check Help-\> Cheat Sheet -\> Data visualization with ggplot 2, where there is lots of help on ggplot.

**Figure 1 - Boxplots**

Now we need to read the dataset (Wassen_fig2) in R from the Data folder (see data wrangling how this was done). Lets store the dataset in a dataframe called NP_sp. Afterwards check the dataframe. What are the columns that we need for our figure?

```{r}
#store data as dataframe 
#check with benjamin so the functions are similar.
NP_sp <- read.csv("Data/NPsp_Wassen.csv")
head(NP_sp)

```

The grammar used in ggplot is as following:

`ggplot(data = df, mapping = aes(x, y, other aesthetics))`

where df is the dataframe, and x and y the names of the columns you would like to call.

So lets do this first for our example.

```{r}
#create ggplot
ggplot(data = NP_sp, mapping = aes(threatened, NP_median))

```

As you can see there is no Boxplot, but the framework is there. That is because we have only created a frame, with x and y axis, but object are still missing. As we are aiming to add a boxplot we are using the geom_boxplot function. Within the geom_boxplot we can add certain aestathic preference such a width=1.

```{r}
#create ggplot
ggplot(data = NP_sp, mapping = aes(threatened, NP_median))+geom_boxplot(width=0.5)

```

It works, but we want to restyle the graph by use a white background. This is easily achieved by the function theme_minimal() (with lines or theme_classic without lines). Next we would like to fill the boxplots using a red (threatened) and blue (non-threatened) species. For this we use fill = threatened in the aesthetics of the ggplot and define a scale_color_manual(values=c('colour', etc)). See https://www.uvm.edu/\~ngotelli/Rscripts/ColorChart.pdf for nice colour names or #hex.

```{r}
#create ggplot
ggplot(data = NP_sp, mapping = aes(threatened, NP_median, fill=threatened))+geom_boxplot(width=0.5)+theme_minimal()+scale_fill_manual(values=c("steelblue2","firebrick2" ))
```

No we we will add points, as we would like to now the underlying data of the boxplot. You could use geom_point but this runs in to troubles.

```{r}
#create ggplot
ggplot(data = NP_sp, mapping = aes(threatened, NP_median, fill=threatened))+geom_boxplot(width=0.5)+theme_minimal()+scale_fill_manual(values=c("steelblue2","firebrick2" )) +geom_point()
```

The points all fall on one line and it is unclear how the data is distributed. To solve this we could use the funtion geom_jitter() and remove the point produced by the boxplots using outlier.shape = NA in geom_boxplot(). In geom_jitter we use the function alpha to make them a bit transparent, and width to determine how much the points are spread.

```{r}
#create ggplot
ggplot(data = NP_sp, mapping = aes(threatened, NP_median, fill=threatened))+geom_boxplot(width=0.5,outlier.shape = NA)+theme_minimal()+scale_fill_manual(values=c("steelblue2","firebrick2" )) +geom_jitter(alpha=0.2, width=0.1)
```

Finally I would like to remove the lines of the axis using the theme() function. this can be done by setting the axis.line = element_blank(). Furhermore, there is still a legend, but we dont need it; for this we add within theme the legend.position = "none". Lastly we should rename the labels of NP_median in N/P by using the function labs(y="name)".

```{r}
#create ggplot
ggplot(data = NP_sp, mapping = aes(threatened, NP_median, fill=threatened))+geom_boxplot(width=0.5,outlier.shape = NA)+theme_minimal()+scale_fill_manual(values=c("steelblue2","firebrick2" )) +geom_jitter(alpha=0.2, width=0.1)+ theme(axis.line = element_blank(),  legend.position = "none")+labs(y= "N/P")
```

If we would like to do make a similar comparison we could like to use the same code but then swap y in aes() for P_median and change the labs(). We can also save ggplots as an object lets save the N/P plots as np_box and the P boxplot as p_box.

```{r}
#create ggplot
np_box<-ggplot(data = NP_sp, mapping = aes(threatened, NP_median, fill=threatened))+geom_boxplot(width=0.5,outlier.shape = NA)+theme_minimal()+scale_fill_manual(values=c("steelblue2","firebrick2" )) +geom_jitter(alpha=0.2, width=0.1)+ theme(axis.line = element_blank(),  legend.position = "none")+labs(y= "N/P")

#create ggplot p_box
p_box<-ggplot(data = NP_sp, mapping = aes(threatened, P_median, fill=threatened))+geom_boxplot(width=0.5,outlier.shape = NA)+theme_minimal()+scale_fill_manual(values=c("steelblue2","firebrick2" )) +geom_jitter(alpha=0.2, width=0.1)+ theme(axis.line = element_blank(),  legend.position = "none")+labs(y= "P")
```

Now we have saved both boxplots we can combine the together to get one new figure. For this we use the ggarrange() function within the package ggpubr. Install and load that package. Afterwards we can make both object into one figure by providing ggarrange() with the objects. We should also provide the function with the nrow or ncol and the labels c("a", "b").

```{r}
install.packages('ggpubr')
library(ggpubr)


#Arrange a new figure
ggarrange(p_box, np_box, labels = c("a", "b"), ncol = 2, nrow = 1)
```

**Figure 2 - Scatter plots**

Scheifes et al. use cmtv.csv. Explain the concepts of community mean traits. If interested all R scripts are available to see how this is done. We will work with the output of the data wrangling stored in ctmvs. csv.

We would like to combine some of the results that show that community associations with fungi increase along a biomass, and decreases along a N to P gradient.

```{r}
##store data as dataframe 
#check with benjamin so the functions are similar.
NP_tr <- read.csv("CMTV_Scheifes.csv")
head(NP_tr)
```

No we will make two ggplots. one by biomass, other one by NP and add point using geom_point. We will first start with makin the graph for biomass. colour should be grreen, correct alpha.

```{r}
#create ggplot
ggplot(data = NP_tr, mapping = aes(biomass_vascular_plants_g/m2, aveAM))

```

AS you can see, we have the data but there is no linear model in the grpah. As the paper uses a more complex. You can use the geom_smooth function to fit a linear model.

```{r}
Geom_smooth()
```

As you can see the model is only a visualization but does not give you information on p r squared etc. to add this information you can use annotate. Run an lm and store the data of the R-squared, p - value and equation, so you can show p-valueit in the graphs

```{r}
annotate("text", x = 0.9, y = 3.3, 
           label = paste("R-squared =", round(r_squared, 3), "\n", "p-value =", format(p_value, scientific = TRUE),
                         "\n", "Equation:", equation),
           hjust = 0, vjust = 1, size = 3)

```

Ask for Feedback following this link.
